<!DOCTYPE html>
<html>
<style>
    * {
        box-sizing: border-box;
    }

    html,
    body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
    }

    body {
        background-color: whitesmoke;
    }

    main {
        padding: 2em;
        width: 30em;
        margin: 10em auto;
        background-color: white;
    }

    #q {
        font-weight: bold;
    }

    .answers {
        line-height: 1.5em;
    }

    .answer>label {
        line-height: 1.5em;
        cursor: pointer;
    }

    input[type=radio] {
        cursor: pointer;
    }

    input[type=radio]:disabled {
        display: none;
    }

    input[type=radio]:disabled+label {
        cursor: default;
    }

    :disabled+label[correct='no']::before {
        content: '❌';
        margin-left: .5em;
    }

    :disabled+label[correct='yes']::before {
        content: '✔️';
        margin-left: .5em;
    }

    #chat {
        max-height: 80em;
        margin: 2em 0;
        overflow: auto;
        font-size: .8em;
        opacity: 0;
        /* transition: opacity 3s; */
    }

    .msg {
        margin: .5em 0;
        padding: .3em .5em;
        background-color: #f0fff3;
        border: 1px solid #eee;
        border-radius: .5em;
    }

    time {
        color: #999;
        font-size: .8em;
        float: left;
    }

    .sender {
        font-weight: bold;
    }
</style>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>

    <title>מי אמר למי?</title>

    <meta property="og:title" content="מי אמר למי?">
    <meta property="og:site_name" content="מי אמר למי?">
    <meta property="og:url" content="">
    <meta property="og:description" content="מי אמר למי?.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="favicon.png">

    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel="icon" type="image/png" href="favicon.png" />


</head>

<body dir='rtl'>
    <main>
        <p>מי אמר/ה?</p>
        <p id='q'></p>

        <div id='answers'>
        </div>

        <div id="chat"></div>

        <div class="next">
            <button id='next'>next</button>
        </div>
    </main>
</body>

<script>
    function $(id) {
        return document.getElementById(id);
    }

    function e(html) {
        const div = document.createElement('div')
        div.innerHTML = html
        return div.firstElementChild
    }

    class Question {
        constructor(text) {
            this.e = $('q');
        }
        set text(text) {
            this.e.innerText = text;
        }
    }

    class Answer {
        static id = 0;
        constructor() {
            const id = Answer.id++;
            this.e = e(`
                <div class="answer">
                    <input type='radio' id='${id}' name='answer' />
                    <label for='${id}' correct='no'></label>
                </div>
            `)
            $('answers').appendChild(this.e)

            this.e.addEventListener('change', () => {
                $('chat').style.opacity = 1;
                for (let i = 0; i < Answer.id; i++) {
                    $(i).disabled = true;
                }
                nextButton.disabled = false;
            })

            this.label = this.e.querySelector('label')
        }

        set text(text) {
            this.label.innerText = text;
            const input = this.e.querySelector('input')
            input.disabled = false;
            input.checked = false;
        }

        set correct(correct) {
            this.label.setAttribute('correct', correct ? 'yes' : 'no')
        }
    }

    class Chat {
        constructor() {
            this.e = $('chat');
        }
        set msgs(msgs) {
            this.e.style.opacity = 0;
            this.e.innerHTML = '';
            for (const msg of msgs) {
                this.e.appendChild(e(`
                    <div class='msg'>
                        <time>${msg.time}</time>
                        <span class='sender'>${msg.sender}</span>
                        <div>${msg.text}</div>
                    </div>
                `))
            }
        }
    }


    const question = new Question();
    const answers = [new Answer(), new Answer(), new Answer()];
    const chat = new Chat();
    const nextButton = $('next');

    let qid = 0;
    const quiz = [{ "text": "ידעתי שהיה חסר משהו...רק לא הצלחתי לשים את האצבע על זה", "sender": "איילת אדלר", "senders": ["ד\"ר טליה שנצר", "איילת אדלר", "אופיר שנצר"], "chat": [{ "time": "25/04/2019, 21:47", "sender": "איילת אדלר", "text": "ידעתי שהיה חסר משהו...רק לא הצלחתי לשים את האצבע על זה" }, { "time": "25/04/2019, 21:48", "sender": "אופיר שנצר", "text": "😅" }] }, { "text": "עינבי בהופעה של הלהקה הייצוגית של מוצקין (בדומה למעיין בעבר) לפני ילדי הגנים. ", "sender": "איילת אדלר", "senders": ["פסיה שנצר", "אופיר שנצר", "איילת אדלר"], "chat": [{ "time": "06/05/2019, 07:56", "sender": "איילת אדלר", "text": "עינבי בהופעה של הלהקה הייצוגית של מוצקין (בדומה למעיין בעבר) לפני ילדי הגנים. " }, { "time": "06/05/2019, 08:19", "sender": "אלי שנצר", "text": "מאוד יפה👏👏" }, { "time": "06/05/2019, 08:31", "sender": "פסיה שנצר", "text": "מאד יפה.👏" }] }]

    function next() {
        nextButton.disabled = true;
        const q = quiz[qid];
        question.text = q.text;
        chat.msgs = q.chat;

        for (let i = 0; i < answers.length; i++) {
            answers[i].text = quiz[qid].senders[i];
            answers[i].correct = quiz[qid].senders[i] === q.sender;
        }

        qid++;
    }

    nextButton.addEventListener('click', next);
    next();

</script>

</html>